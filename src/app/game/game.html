@let _finder = finder();
<!-- prettier-ignore -->
@let _loading = loading();
<div aria-atomic="false" aria-relevant="all" aria-live="assertive" class="text-center">
  <div class="flex justify-center pt-2">
    @for (character of characters; track character.name) {
    <!-- prettier-ignore -->
    @let size = 45;
    @let found = foundCharacters().includes(character.name);
    <img
      [width]="size"
      [height]="size"
      [ngSrc]="character.image.src"
      [alt]="`${character.image.alt} (${found ? '' : 'not'} found)`"
      [class]="found ? '' : 'saturate-70 opacity-70'"
    />
    }
  </div>
  <div class="border-1 border-black">
    @let _notification = notifier.notification;
    <div
      class="p-2 bg-black text-white font-bold"
      [class]="{
        'bg-red-700': _notification.type === 'error',
        'bg-green-700': _notification.type === 'success'
      }"
    >
      <p>{{ _notification.message || 'Please help us find Waldo and his friends.' }}</p>
      <div
        [class]="`*:inline-block *:m-1 *:text-sm *:py-1 *:px-2 *:min-w-24 *:shadow-sm *:border-2
          *:rounded-lg  *:cursor-pointer *:active:not-disabled:bg-gray-500`"
      >
        <button
          type="button"
          (click)="_finder ? escape() : start()"
          class="disabled:text-gray-300 disabled:border-gray-300"
          [disabled]="_loading || _notification.type !== 'normal' || (_finder && gameOver())"
        >
          @if(_finder){Escape}@else{Start@if(_loading){ing...}}
        </button>
        <label
          for="sounds-toggler"
          [class]="`*:align-middle
            ${sounds.enabled ? '' : 'line-through text-gray-300 border-gray-300'}`"
        >
          <span> Sounds </span>
          <input
            type="checkbox"
            id="sounds-toggler"
            [checked]="sounds.enabled"
            (change)="sounds.toggle()"
            class="appearance-none hidden"
          />
        </label>
      </div>
    </div>
    @if (_finder) {
    <app-stats
      class="border-t-1"
      [elapsedSeconds]="timer.seconds + 1"
      [foundCharacters]="characterSelection.getFoundCharacters().length"
    />
    <div class="relative overflow-hidden">
      <div class="pt-[63.3984%]">
        <!-- Fill the parent's height relative to its width (old school `aspect-ratio`) -->
      </div>
      <button
        type="button"
        [class]="{ 'saturate-25': _loading }"
        [class]="`focus-visible:outline-none focus-visible:inset-ring-2 inset-ring-black/20
          absolute top-0 left-0 right-0 bottom-0`"
        (click)="!_loading && selectCharacter($event)"
      >
        <img
          fill
          #crowd
          priority
          ngSrc="/where-is-waldo-winter.jpg"
          alt="An illustration of a crowd of people skiing on an icy mountain, where you can find Waldo and his friends."
          class="absolute top-0 left-0 right-0 bottom-0 -z-10"
        />
      </button>
      @if (_loading) {
      <span class="absolute top-0 left-0 right-0 bottom-0 bg-white/75 animate-pulse"></span>
      }
      <!-- prettier-ignore -->
      @if (gameOver()) {
      <div
        class="{{`absolute top-0 left-0 right-0 bottom-0 z-10
          bg-black/75 backdrop-saturate-25 backdrop-blur-xs`}}"
      >
        <app-finder-form
          [finder]="_finder"
          (submitted)="reset()"
          class="{{`absolute top-1/2 left-1/2 -translate-1/2 w-full max-w-2xs
              bg-white py-6 px-4 rounded-2xl`}}"
        />
      </div>
      } @if (characterSelection.selectedPoint && characterSelection.imageElement) {
      <app-character-menu
        [imageElement]="characterSelection.imageElement"
        [selectedPoint]="characterSelection.selectedPoint"
        (characterSelected)="evaluateSelectedCharacter($event)"
      />
      }
    </div>
    } @else {
    <app-finder-list class="border-t-1" />
    }
  </div>
</div>
